# Module 3 设计文档
## 1. 模块目的
在给定的模拟周期内，基于网络层级与提前期，汇总“未来订单 + 需求预测 + 安全库存”，结合库存与在途/入库/生产/跨点发运/开放调拨等供给要素，逐层回推形成每日的净需求（对上游的拉动需求）。
- 将下游需求（订单、预测、安全库存目标）与上游供给（期初、在途、当日/未来入库、已承诺调拨）统一核算，量化缺口。
- 自动识别网络根节点及层级，并按**提前期**将缺口**逐层向上**传递。
- 输出可落地的净需求清单，作为后续生产计划的输入。

## 2. 适用业务场景
- 分层MRP推演：多级网络（工厂—区域DC—前置仓）逐层上推净需求。

- 滚动日度模拟：在一段模拟周期内，逐日计算净需求并形成日文件。

- 网络变更生效：网络配置存在生效区间时，按当日有效配置进行计算。

- Plant/DC差异口径：对工厂与仓库采取不同的提前期口径与参数来源。

- 跨模块集成：消费来自 Module 1 的“未来预测 SupplyDemand”“当日发货 ShipmentLog”“未来订单 OrderLog”等数据，并结合中台（Orchestrator）的库存与物流视图。

## 3. 关键业务规则与口径
### 3.1 需求池组成（仅限模拟周期内）
- 未来订单：只纳入明日及以后（date > 仿真日）的订单；当日订单不计入需求池，避免与当日normal - order发货重复。
- 未来预测：来自 Module 1 的 SupplyDemandLog（已扣减当日订单消耗后的剩余预测）。
- 安全库存目标：以“仿真日 + 提前期天数”当日的目标值作为当次校验。

### 3.2 可用库存口径（按节点当日）
- 加项：期初库存、在途数量、当日在途收货、当日生产收货、提前期内的未来确认生产计划
- 减项：当日客户发货、当日作为发送端的跨点发运、当日已开放的调拨数量
- 说明：以上视图均以当日版本为准，避免重复计量
